name: install

on:
  push:
    tags:
      - 'v.*.*'

jobs:
  docker:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: install plugin
        run: ansible-galaxy collection install ansible.utils 

      - name: run playbook replacing-variables.yml 
        env:
          PASS: ${{ secrets.PASSFORSECRET }}
        run: echo $PASS > password | ansible-playbook --extra-vars="@secretbot.yml" --vault-password-file password replacing-variables.yml

      - name: ls
        run: ansible all --list-hosts

      - name: run playbook initial_installation.yml
        env:
          ANSIBLE_HOST_KEY_CHECKING: False
        run: ansible-playbook -i inventory.yml --extra-vars "@vars.yml" install_k3s.yml -u foilv

          
